# 📝 2024.10.16 회고 📝
#### 1. 수업 내용 복습정리
#### 2. 백준

---------------------------------

## 아키텍처 설계 사례 분석 : Netflix

![image](https://github.com/user-attachments/assets/99a96890-3362-4d68-bfae-64ded5c031b5)
- 넷플릭스 시스템 디자인 배너

#### Netflix 시스템

- 기능적 요구 사항
  - 사용자는 계정을 만들고 로그인하고 로그아웃할 수 있어야 함
  - 사용자를 위한 구독 관리
  - 사용자가 비디오를 재생하고 일시 정지, 재생, 되감기, 빨리 감기 기능을 사용할 수 있도록 함
  - 오프라인에서 볼 수 있도록 콘텐츠를 다운로드할 수 있는 기능
  - 사용자 선호도와 시청 기록에 따른 개인화된 콘텐츠 추천

- 비기능적 요구 사항
  - 콘텐츠 재생 중 지연 시간이 짧고 반응성이 높아야 함
  - 많은 수의 동시 사용자를 처리할 수 있는 확장성 요구
  - 최소한의 다운타임으로 높은 가용성을 보장해야 함
  - 안전한 사용자 인증 및 권한 부여
  - 쉬운 탐색을 위한 직관적인 사용자 인터페이스

#### Netflix 시스템 설계의 상위 수준 설계
![image](https://github.com/user-attachments/assets/d930d199-7d6c-4f87-a8dc-181b4f88c11b)
- [고수준 시스템 아키텍처]

#### 기반 클라우드 시스템
- AWS, Open Connect의 두 클라우드에서 작동함
- 두 클라우드는 Netflix의 백본으로 함께 작동함


- OC(Open Connect) 또는 Netflix CDN 사용
  - CDN: 다양한 지리적 위치에 분산된 서버 네트워크
  - Open Connect: Netflix만의 맞춤형 글로벌 CDN(콘텐츠 전송 네트워크)

- 비디오 스트리밍과 관련된 모든 것을 처리함
- 다양한 위치에 배포되어 있음
- 디바이스에서 재생 버튼을 누르면
  - 이 구성 요소의 비디오 스트림이 장치에 표시됨
  - 예: 북미에 위치한 사용자가 비디오를 재생하려고 하는 경우,
    - 비디오는 원래 서버가 아닌 가장 가까운 오픈 커넥트(또는 서버)에서 제공됨
    - 가장 가까운 서버에서 더 빠른 응답을 받을 수 있음

- 백엔드(데이터베이스)
  - 재생 버튼을 누르기 전까지 비디오 스트리밍과 관련되지 않은 모든 작업을 처리함
    - 새로운 콘텐츠의 온보딩
    - 비디오 처리
    - 전 세계 여러 지역에 있는 서버에 비디오 배포
    - 네트워크 트래픽 관리 등
- 대부분의 프로세스는 Amazon Web Services가 처리함

#### 마이크로서비스 아키텍처
- Netflix의 아키텍처 스타일은 서비스의 모음으로 구축됨(마이크로서비스 아키텍처)
- 애플리케이션과 웹 앱에 필요한 모든 API를 구동함
- 요청이 엔드포인트에 도착하면
- 필요한 데이터를 위해 다른 마이크로서비스를 호출하고
  - 이러한 마이크로서비스는 다른 마이크로서비스에서 데이터를 요청할 수도 있음
- 그 후 API 요청에 대한 완전한 응답이 엔드포인트로 다시 전송됨

- 마이크로서비스(Microservice) 아키텍처
- 애플리케이션을 느슨하게 결합된 서비스의 모임으로 구조화하는 서비스 지향 아키텍처(SOA) 스타일의 일종인 소프트웨어 개발 기법
- 마이크로서비스 아키텍처에서 서비스들은 섬세(fine-grained)하고 프로토콜은 가벼운 편
- 애플리케이션을 작은 여러 서비스로 분해할 때의 장점
  - 모듈성의 개선
  - 애플리케이션의 이해, 개발, 테스트가 용이함
  - 애플리케이션 침식에 대하여 더욱 탄력적으로 대응할 수 있음
  - 규모가 작은 자율적인 팀들이 팀별 서비스를 독립적으로 개발, 전개, 규모 확장을 할 수 있게 함으로써 병렬 개발을 가능하게 함
  - 지속적인 리팩터링을 통해 개개의 서비스 아키텍처가 하나로 병합될 수 있게 허용
  - 지속적 배포와 전개(디플로이)를 가능하게 함
- 마이크로서비스 아키텍처에서 서비스는 서로 독립적이어야 함
  - 예: 비디오 저장 서비스는 비디오 트랜스코딩을 담당하는 서비스에서 분리됨

![image](https://github.com/user-attachments/assets/9965a5af-c98e-4618-88f9-afb5c05da2f3)
- [마이크로서비스 아키텍처]

#### 마이크로서비스 아키텍처를 안정적으로 만드는 방법
- Hystrix의 사용

- 중요한 마이크로서비스 분리
  - 일부 중요한 서비스(또는 엔드포인트 또는 API)를 분리하여 다른 서비스에 대한 종속성이나 독립성을 낮출 수 있음
  - 또한 일부 중요한 서비스를 다른 안정적인 서비스에만 종속시킬 수도 있음
  - 중요한 마이크로서비스를 선택할 때 비디오 검색, 비디오 탐색, 비디오 클릭 및 재생 등 모든 기본 기능을 포함할 수 있음
  - 이렇게 하면 엔드포인트의 가용성을 높일 수 있으며 최악의 상황에서도 적어도 한 명의 사용자는 기본적인 작업을 수행할 수 있음

- 서버를 무상태로 처리
  - 엔드포인트 중 하나에서 오류가 발생하거나 적절한 시기에 요청을 처리하지 못하는 경우 다른 서버로 전환하여 작업을 완료할 수 있도록 서비스를 설계하는 것이 아이디어
    - 예: 젖소 떼로부터 매일 얼마나 많은 갤런의 우유를 얻는지가 중요하다고 할 때,
      - 어느 날 젖소에서 우유가 줄었다는 것을 알게 되면
      - 그 젖소(우유 생산량 감소)를 다른 젖소로 교체하면 됨
      - 필요한 양의 우유를 얻기 위해 특정 소에 의존할 필요는 없음
      - 이 예시를 애플리케이션과 연관시킬 수 있음

##### Hystrix
- 애플리케이션이 외부 시스템으로 인한 서비스의 지연과 장애에 대해 내성을 갖게 해주는 라이브러리
- Netflix에서 개발했으며, 현재는 유지보수만 진행 중

- 지원하는 기능
  - 빠른 실패(외부 시스템 혹은 서비스의 지연에 대한 빠른 실패처리)
  - 기본적으로 Thread Pool을 이용하여 포화 상태가 될 경우 앞으로의 요청은 실패 처리
  - 호출 실패에 대한 fallback 메소드 제공
  - 연쇄 장애 방지
  - Thread 혹은 Semaphore 전략에 따른 circuit breaker 기능
  - 실시간 모니터링


- Hystrix의 기본 동작
  - HystrixCommand 혹은 HystrixObservableCommand 객체를 생성
  - Command 객체를 동작시킴(proxy의 역할)
  - Cache의 여부를 확인
  - Circuit breaker 확인(open[사용 불가 상태], close)
  - 세마포어 혹은 Thread pool의 Thread를 사용할 수 있는 상태인지를 체크
  - 실질적인 로직을 통작시킴(run() 메소드를 통해)
  - Circuit breaker를 open 상태로 돌려야할지의 여부 체크
  - 로직의 에러 혹은 circuit open 상태일 경우 빠른 실패 처리

![image](https://github.com/user-attachments/assets/01f168c2-0ea4-4886-8f34-979451b8253b)
- [ Hystrix 기본 동작]












```
